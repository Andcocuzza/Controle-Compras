<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Compras por Data - Mobile Friendly</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="estilo.css" />
</head>
<body>
  <h1>Controle de Compras no Supermercado</h1>

  <div class="linha-campos">
    <div class="campo">
      <label for="produto">Produto:</label>
      <input type="text" id="produto" autocomplete="off" />
    </div>
    <div class="campo">
      <label for="preco">Preço:</label>
      <input type="number" id="preco" step="0.01" min="0" />
    </div>
  </div>

  <div class="linha-campos">
    <div class="campo">
      <label for="local">Local:</label>
      <select id="local">
        <option value="Cozinha">Cozinha</option>
        <option value="Limpeza">Limpeza</option>
        <option value="Banheiro">Banheiro</option>
        <option value="Sala">Sala</option>
        <option value="Quarto">Quarto</option>
      </select>
    </div>
    <div class="campo">
      <label for="data">Data da compra:</label>
      <input type="date" id="data" />
    </div>
  </div>

  <button onclick="adicionarCompra()">Adicionar Compra</button>

  <hr />

  <label for="mesAno">Visualizar compras de:</label>
  <input type="month" id="mesAno" onchange="carregarCompras()" />

  <h2>Compras deste mês:</h2>
  <div id="listaCompras"></div>

  <h3>Total gasto no mês: R$ <span id="totalMes">0.00</span></h3>

<script>
  function preencherDataAtual() {
    const hoje = new Date();
    const ano = hoje.getFullYear();
    const mes = String(hoje.getMonth() + 1).padStart(2, '0');
    const dia = String(hoje.getDate()).padStart(2, '0');
    const dataFormatada = `${ano}-${mes}-${dia}`;
    document.getElementById('data').value = dataFormatada;
  }

  function carregarDados() {
    const dados = localStorage.getItem('comprasPorData');
    return dados ? JSON.parse(dados) : {};
  }

  function salvarDados(dados) {
    localStorage.setItem('comprasPorData', JSON.stringify(dados));
  }

  function adicionarCompra() {
    const nomeProduto = document.getElementById('produto').value.trim();
    const precoProduto = parseFloat(document.getElementById('preco').value);
    const localProduto = document.getElementById('local').value;
    const dataCompra = document.getElementById('data').value;

    if (!nomeProduto || isNaN(precoProduto) || !dataCompra) {
      alert('Preencha corretamente nome, preço e data da compra.');
      return;
    }

    const dados = carregarDados();

    if (!dados[dataCompra]) {
      dados[dataCompra] = [];
    }

    dados[dataCompra].push({
      nome: nomeProduto,
      preco: precoProduto,
      local: localProduto
    });

    salvarDados(dados);
    limparCampos();
    carregarCompras();
  }

  function limparCampos() {
    document.getElementById('produto').value = '';
    document.getElementById('preco').value = '';
    document.getElementById('local').value = 'Cozinha';
    preencherDataAtual();
  }

  function carregarCompras() {
    const mesAno = document.getElementById('mesAno').value;
    const listaElement = document.getElementById('listaCompras');
    const dados = carregarDados();

    listaElement.innerHTML = '';
    let totalMes = 0;

    if (!mesAno) return;

    const datasDoMes = Object.keys(dados).filter(data => data.startsWith(mesAno));

    if (datasDoMes.length === 0) {
      listaElement.textContent = 'Nenhuma compra registrada neste mês.';
      document.getElementById('totalMes').textContent = '0.00';
      return;
    }

    datasDoMes.sort();

    for (const data of datasDoMes) {
      const tituloData = document.createElement('h4');
      tituloData.textContent = `Data: ${data}`;
      listaElement.appendChild(tituloData);

      const ul = document.createElement('ul');

      dados[data].forEach((compra, index) => {
        const item = document.createElement('li');
        item.textContent = `${compra.nome} - ${compra.local} - R$ ${compra.preco.toFixed(2)}`;

        const btnRemover = document.createElement('button');
        btnRemover.textContent = 'Remover';
        btnRemover.onclick = () => {
          removerCompra(data, index);
        };

        item.appendChild(btnRemover);
        ul.appendChild(item);

        totalMes += compra.preco;
      });

      listaElement.appendChild(ul);
    }

    document.getElementById('totalMes').textContent = totalMes.toFixed(2);
  }

  function removerCompra(data, index) {
    const dados = carregarDados();
    dados[data].splice(index, 1);

    if (dados[data].length === 0) {
      delete dados[data];
    }

    salvarDados(dados);
    carregarCompras();
  }

  // Inicializa com o mês atual selecionado e data atual preenchida
  const hoje = new Date();
  document.getElementById('mesAno').value = hoje.toISOString().slice(0, 7);
  preencherDataAtual();
  carregarCompras();
</script>
</body>
</html>
